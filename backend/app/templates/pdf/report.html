<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>{{ report.title }}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    

    <style>

        /* --- 1. PREMIUM VARIABLES --- */

        :root {

            --primary: {{ client.primary_color | default('#10b981') }};

            --primary-dim: {{ client.primary_color | default('#10b981') }}15;

            --dark: #09090b;

            --slate: #334155;

            --light-gray: #f8fafc;

            --border: #e2e8f0;

            

            /* Severity Colors */

            --sev-critical: #be123c; --sev-critical-bg: #fff1f2;

            --sev-high: #c2410c;     --sev-high-bg: #fff7ed;

            --sev-medium: #eab308;   --sev-medium-bg: #fefce8;

            --sev-low: #10b981;      --sev-low-bg: #ecfdf5;

            --sev-info: #3b82f6;     --sev-info-bg: #eff6ff;

        }



        /* --- 2. CLEAN PAGE GEOMETRY (No Header Space Needed) --- */

        @page {

            size: A4;

            margin: 20mm; /* Standard, Safe Margins all around */

        }



        @page :first { margin: 0 !important; } /* Full Bleed Cover Override */



        body {

            font-family: 'Inter', sans-serif;

            font-size: 10pt;

            line-height: 1.6;

            color: #1e293b;

            margin: 0;

            background: #fff;

            -webkit-print-color-adjust: exact;

        }



        .page-break { page-break-after: always; }

        .no-break { page-break-inside: avoid; }



        h1, h2, h3, h4 { margin: 0; font-weight: 700; color: #0f172a; }

        p { margin-bottom: 1.2em; }

        a { color: var(--primary); text-decoration: none; }



        /* --- 3. COVER PAGE (Dark Cyber Grid) --- */

        .cover-page {

            width: 210mm; height: 297mm;

            background-color: var(--dark); color: white;

            position: relative; z-index: 9999;

            display: flex; flex-direction: column; justify-content: center;

            background-image: 

                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),

                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);

            background-size: 40px 40px;

        }

        

        .cover-bar { position: absolute; left: 0; top: 0; bottom: 0; width: 8px; background: var(--primary); box-shadow: 0 0 40px var(--primary); }

        .cover-content { padding: 0 25mm; }

        

        .confidential-pill {

            font-family: 'JetBrains Mono', monospace; font-size: 9pt; color: var(--primary);

            border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02);

            padding: 8px 16px; border-radius: 100px; display: inline-block; margin-bottom: 40px;

            text-transform: uppercase; letter-spacing: 2px;

        }

        

        h1.cover-title { font-size: 38pt; font-weight: 800; line-height: 1.1; color: #ffffff; margin: 0; letter-spacing: -0.03em; }

        

        .cover-footer {

            position: absolute; bottom: 0; left: 0; right: 0; padding: 20mm 25mm;

            border-top: 1px solid rgba(255,255,255,0.1); 

            background: rgba(0,0,0,0.4); backdrop-filter: blur(20px);

            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;

        }

        .cf-label { font-family: 'JetBrains Mono'; font-size: 7pt; color: #9ca3af; text-transform: uppercase; display: block; margin-bottom: 6px; letter-spacing: 1px; }

        .cf-value { font-size: 11pt; font-weight: 600; color: #fff; }



        /* --- 4. SECTION TITLES --- */

        h2.section-title {

            font-size: 18pt; text-transform: uppercase; letter-spacing: 0.05em; color: var(--dark); 

            border-bottom: 2px solid var(--dark); padding-bottom: 15px; margin-bottom: 40px; margin-top: 0;

        }

        

        h2.section-title-green {

            font-size: 18pt; text-transform: uppercase; letter-spacing: 0.05em; color: var(--primary); 

            border-bottom: 2px solid var(--primary); padding-bottom: 15px; margin-bottom: 30px; margin-top: 40px;

        }



        /* --- 5. ENGAGEMENT DETAILS (BEST OF BOTH WORLDS) --- */

        .engagement-card {

            border: 1px solid var(--border);

            border-radius: 8px;

            overflow: hidden;

            margin-bottom: 40px;

            box-shadow: 0 4px 10px rgba(0,0,0,0.03);

        }



        /* Dark Header */

        .engagement-header {

            background: var(--dark);

            color: white;

            padding: 15px 25px;

            display: flex; justify-content: space-between; align-items: center;

            border-bottom: 3px solid var(--primary);

        }

        .eh-title { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; font-size: 10pt; }

        .eh-tag { font-family: 'JetBrains Mono'; font-size: 8pt; opacity: 0.8; letter-spacing: 1px; }



        /* The Grid */

        .engagement-grid {

            display: grid; grid-template-columns: 1fr 1fr; background: #fff;

        }

        

        .eng-cell {

            padding: 20px 25px;

            border-right: 1px solid var(--border);

            border-bottom: 1px solid var(--border);

        }

        .eng-cell-full { grid-column: 1 / -1; border-right: none; }

        .eng-cell:nth-child(even) { border-right: none; }



        .eng-label {

            display: block; font-size: 9pt; color: var(--primary); font-weight: 800; 

            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;

        }

        .eng-value {

            font-size: 11pt; font-weight: 600; color: var(--slate); font-family: 'Inter', sans-serif;

        }

        .eng-date {

            font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px;

        }



        /* Scope Footer */

        .scope-section {

            background: #fafafa; padding: 25px;

        }

        .scope-item {

            font-family: 'JetBrains Mono'; font-size: 11pt; color: var(--dark);

            margin-bottom: 5px; display: flex; align-items: center;

        }

        .scope-arrow { color: var(--primary); margin-right: 10px; font-weight: bold; }



        /* --- 6. SUMMARY CHARTS --- */

        .risk-dashboard {

            display: flex; gap: 40px; align-items: center; margin-bottom: 50px; padding: 25px; border: 1px solid var(--border); border-radius: 12px;

        }

        .risk-circle {

            width: 120px; height: 120px; border-radius: 50%; border: 10px solid var(--dark);

            display: flex; flex-direction: column; justify-content: center; align-items: center; flex-shrink: 0;

        }

        .risk-grid { flex-grow: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }

        .risk-stat-box { padding: 10px; text-align: center; border-right: 1px solid var(--border); }

        .risk-stat-box:last-child { border-right: none; }

        .rs-num { font-size: 24pt; font-weight: 800; display: block; line-height: 1; margin-bottom: 5px; }

        .rs-lbl { font-size: 7pt; font-weight: 700; text-transform: uppercase; color: var(--slate); letter-spacing: 1px; }



        /* --- 7. FINDING CARD --- */

        .finding-card {

            border: 1px solid var(--border); margin-bottom: 50px;

            page-break-inside: avoid; background: #fff; border-radius: 8px; overflow: hidden;

            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);

        }

        .finding-header-strip {

            padding: 12px 25px; color: white; font-weight: 700; font-size: 11pt;

            display: flex; justify-content: space-between; align-items: center;

        }

        .bg-CRITICAL { background: var(--sev-critical); }

        .bg-HIGH { background: var(--sev-high); }

        .bg-MEDIUM { background: var(--sev-medium); }

        .bg-LOW { background: var(--sev-low); }

        .bg-INFO { background: var(--sev-info); }



        .finding-meta-grid {

            display: grid; grid-template-columns: 2fr 1fr; border-bottom: 1px solid var(--border); background: var(--light-gray);

        }

        .meta-cell { padding: 15px 25px; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); }

        .meta-cell:last-child { border-right: none; }

        

        .f-label { display: block; font-family: 'JetBrains Mono'; font-size: 7pt; font-weight: 700; text-transform: uppercase; color: var(--slate); margin-bottom: 6px; letter-spacing: 0.5px; }

        .f-value { font-size: 11pt; font-weight: 600; color: var(--dark); }

        .f-value-mono { font-family: 'JetBrains Mono'; font-size: 9pt; color: var(--dark); }



        .finding-content { padding: 30px 30px; }

        .content-section { margin-bottom: 30px; }

        .content-title {

            font-size: 9pt; font-weight: 800; text-transform: uppercase; 

            color: var(--dark); border-bottom: 2px solid var(--primary); 

            display: inline-block; margin-bottom: 15px; padding-bottom: 4px; letter-spacing: 0.5px;

        }



        .evidence-container { margin-top: 20px; border: 1px solid var(--border); padding: 10px; background: #fff; border-radius: 6px; }

        .evidence-container img { width: 100%; display: block; border-radius: 4px; }

        .evidence-caption { margin-top: 10px; text-align: center; font-size: 8pt; color: var(--slate); font-family: 'JetBrains Mono'; }

        

        .markdown-body ul { padding-left: 20px; }

        .markdown-body pre { background: var(--light-gray); padding: 15px; border: 1px solid var(--border); border-radius: 6px; white-space: pre-wrap; font-family: 'JetBrains Mono'; font-size: 9pt; }

    </style>

</head>

<body>



    <div class="cover-page page-break">

        <div class="cover-bar"></div>

        <div class="cover-content">

            <span class="confidential-pill">CONFIDENTIAL</span>

            <h1 class="cover-title">{{ report.title }}</h1>

        </div>

        <div class="cover-footer">

            <div style="text-align: left;">

                <span class="cf-label">PREPARED FOR</span>

                <span class="cf-value">{{ client.name }}</span>

            </div>

            <div style="text-align: center;">

                <span class="cf-label">DATE</span>

                <span class="cf-value">{{ report.date }}</span>

            </div>

            <div style="text-align: right;">

                <span class="cf-label">REFERENCE ID</span>

                <span class="cf-value" style="font-family: 'JetBrains Mono'">{{ report.id[:8] }}</span>

            </div>

        </div>

    </div>



    <div class="page-break">

        

        <div class="engagement-card">

            <div class="engagement-header">

                <span class="eh-title">Engagement Details</span>

                <span class="eh-tag">CONFIDENTIAL</span>

            </div>



            <div class="engagement-grid">

                <div class="eng-cell eng-cell-full">

                    <span class="eng-label">Report Name</span>

                    <div class="eng-value" style="font-size: 14pt;">{{ report.title }}</div>

                </div>



                <div class="eng-cell">

                    <span class="eng-label">Lead Tester</span>

                    <div class="eng-value">{{ project.lead_tester or 'Security Team' }}</div>

                </div>



                <div class="eng-cell">

                    <span class="eng-label">Testing Period</span>

                    <div class="eng-value eng-date">{{ project.start_date }} - {{ project.end_date }}</div>

                </div>



                <div class="eng-cell">

                    <span class="eng-label">Delivery Date</span>

                    <div class="eng-value eng-date">{{ report.date }}</div>

                </div>

            </div>



            <div class="scope-section">

                <span class="eng-label" style="margin-bottom: 12px;">Assessment Scope</span>

                {% if project.scope %}

                    {% for item in project.scope %}

                    <div class="scope-item">

                        <span class="scope-arrow">></span> {{ item }}

                    </div>

                    {% endfor %}

                {% else %}

                    <div class="scope-item" style="color: var(--slate);">No specific scope items defined.</div>

                {% endif %}

            </div>

        </div>

    </div>



    <div class="page-break">

        <h2 class="section-title">Summary of Findings</h2>

        

        <div class="risk-dashboard">

            <div class="risk-donut-container">

                <div class="risk-circle">

                    <span style="font-size: 32pt; font-weight: 800; line-height: 1;">{{ findings|length }}</span>

                    <span style="font-size: 7pt; font-weight: 700; text-transform: uppercase; color: var(--slate); margin-top: 5px;">Total</span>

                </div>

            </div>

            

            <div class="risk-grid">

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-critical)">{{ stats.critical }}</span>

                    <span class="rs-lbl">Critical</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-high)">{{ stats.high }}</span>

                    <span class="rs-lbl">High</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-medium)">{{ stats.medium }}</span>

                    <span class="rs-lbl">Medium</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-low)">{{ stats.low }}</span>

                    <span class="rs-lbl">Low</span>

                </div>

            </div>

        </div>



        <h2 class="section-title">Executive Narrative</h2>

        <div class="markdown-body">

            {{ report.executive_summary | safe }}

        </div>

    </div>



    <div>

        <h2 class="section-title">Detailed Findings</h2>



        {% for finding in findings %}

        <div class="finding-card">

            <div class="finding-header-strip bg-{{ finding.severity | upper }}">

                <span>FINDING RECORD</span>

                <span style="font-family: 'JetBrains Mono'">{{ finding.finding_id }}</span>

            </div>



            <div class="finding-meta-grid">

                <div class="meta-cell">

                    <span class="f-label">Finding Name</span>

                    <div class="f-value">{{ finding.title }}</div>

                </div>

                <div class="meta-cell">

                    <span class="f-label">Severity</span>

                    <div class="f-value" style="color: var(--sev-{{ finding.severity | lower }})">{{ finding.severity }}</div>

                </div>

                

                <div class="meta-cell">

                    <span class="f-label">Affected Assets</span>

                    <div class="f-value-mono">

                        {% if finding.assets %}

                            {{ finding.assets | join(', ') }}

                        {% else %}

                            All Systems

                        {% endif %}

                    </div>

                </div>

                <div class="meta-cell">

                    <span class="f-label">Remediation Policy</span>

                    <div class="f-value-mono">

                        {% if finding.severity == 'CRITICAL' %}Immediate / 24h

                        {% elif finding.severity == 'HIGH' %}7 Days

                        {% elif finding.severity == 'MEDIUM' %}30 Days

                        {% else %}90 Days{% endif %}

                    </div>

                </div>

            </div>



            <div class="finding-content">

                <div class="content-section">

                    <div class="content-title">Description</div>

                    <div class="markdown-body">{{ finding.description_html | safe }}</div>

                </div>



                <div class="content-section">

                    <div class="content-title">Remediation</div>

                    <div class="markdown-body">{{ finding.remediation_html | safe }}</div>

                </div>



                {% if finding.references %}

                <div class="content-section">

                    <div class="content-title">References</div>

                    <ul class="markdown-body">

                        {% for ref in finding.references %}

                        <li><a href="{{ ref }}" target="_blank">{{ ref }}</a></li>

                        {% endfor %}

                    </ul>

                </div>

                {% endif %}



                {% if finding.evidence_items %}

                <div class="content-section no-break">

                    <div class="content-title">Proof of Concept / Evidence</div>

                    {% for item in finding.evidence_items %}

                    <div class="evidence-container">

                        {% if item.url %}<img src="{{ item.url }}">{% endif %}

                        <div class="evidence-caption">{{ item.caption }}</div>

                    </div>

                    {% endfor %}

                </div>

                {% endif %}

            </div>

        </div>

        {% endfor %}

    </div>



</body>

</html>
